#!/usr/bin/env bash
# configures a HAproxy on a server of New Ubuntu machine
sudo add-apt-repository ppa:vbernat/haproxy-1.7 -y
sudo apt-get update
sudo apt install -y haproxy

sudo sed -i "s/ENABLED=0/ENABLED=1/g" /etc/default/haproxy

FRONT="\\\nfrontend http_front\n\tbind *:80\
     	    \n\tmode http\n\tdefault_backend http_back"
BACK="\\nbackend http_back\n\tbalance roundrobin\
	    \n\tserver 138923-web-01 54.160.108.69:80 check\
	    \n\tserver 138923-web-02 35.175.135.230 check"
sudo sed -i "\$a$FRONT$BACK" /etc/haproxy/haproxy.cfg

sudo service haproxy restart
